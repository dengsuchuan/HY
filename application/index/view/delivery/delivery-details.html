{include file="public/header" /}
<body>
<div class="x-body">
  <xblock>
    <button class="layui-btn" onclick="x_admin_show('选择明细','{:url(\'index/Delivery/selectOrder\',[\'deliveryId\'=>$deliveryId])}')"><i class="layui-icon"></i>添加订单</button>
    <a class="layui-btn" href="javascript:location.replace(location.href);">刷新</a>
  </xblock>
  <fieldset class="layui-elem-field layui-field-title" style="margin-top: 5px;">
    <legend>送货单明细</legend>
  <div class="layui-row">
    <div class="container-wrap">
      <div class="box-1">
        <table class="layui-table">
          <thead>
          <tr>
            <th width="40px;">操作</th>
            <th>明细编号</th>
            <th>所属订单</th>
            <th width="70">送货数量</th>
          </tr>
          </thead>
          {if $deliverOrderCount}
          <tbody>
            <?php $i = 1;?>
            {volist name="orderDatailInfo" id="info"}
            <tr>
              <td>
                <a title="删除" href="javascript:void(0);" onclick="delete_(this,'{$info.deliveryInfoId}')" style="color: red">删除</a>
              </td>
              <?php
               $isTask = getIsTask($info['id']);
               ?>
              <td>{$info.deliveryInfoId}</td>
              <td>{$info.orderCode}</td>
              <td>
                <div class="layui-inline">
                  <div class="layui-input-inline">
                    <input type="number" style="width: 50px;" id="{$info.deliveryInfoId}" autocomplete="off" class="layui-input" value="{$info.quantity}">
                  </div>
                  <a href="#" onclick="updateNum('{$info.deliveryInfoId}')" style="color:green;">修改</a>
                </div>
              </td>
            </tr>
            {/volist}
          </tbody>
          {/if}
        </table>
      </div>
    </div>
  </div>
  </fieldset>
</div>
<script>
    /*删除*/
    function delete_(obj,id){
        layer.confirm('从发货单列表中删除？',function(index){
            var url = "{:url('/index/Delivery/delOrder')}";
            var postData ={"id":id};
            $.post(url,postData,function (result) {
                if(result){
                    $(obj).parents("tr").remove();
                    layer.msg('已删除!',{icon:1,time:1000});
                    $("#sx").click();
                }else {
                    layer.alert("删除失败", {icon: 5});
                }
            },"json");
        });
    }

    function updateNum(id){
        var number = $("#"+id+"").val();
        layer.confirm("明细: <span style='color: green'>"+id+"</span> <br>发货数量改为: <span style='color: green'>"+number+"</span> <br> 确认吗？",function(index){
            var url = "{:url('/index/Delivery/updateNum')}";
            var postData ={"deliveryInfoId":id,'quantity':number};
            $.post(url,postData,function (result) {
                if(result){
                    layer.msg('修改成功!',{icon:1,time:1000});
                    window.location.reload();  //刷新父级页面
                }else {
                    layer.alert("修改失败", {icon: 5});
                }
            },"json");
        });
    }
</script>
</body>
</html>