{include file="public/header" /}
<body>
<div class="x-body">
  <fieldset class="layui-elem-field layui-field-title" style="margin-top: 5px;">
    <legend>工艺信息</legend>
  </fieldset>
  <xblock>
    <button class="layui-btn layui-btn-danger" onclick="delAll()"><i class="layui-icon"></i>批量删除</button>
    <button class="layui-btn" onclick="x_admin_show('工序信息','{:url(\'index/blueprint/addProcess\',[\'id\'=>$drawing_detail_id])}',500,500)"><i class="layui-icon"></i>添加</button>
    <button class="layui-btn" onclick ="sort('{$drawing_detail_id}')" >一键排序</button>
    <span class="x-right" style="line-height:40px">共有数据：{$count} 条</span>
  </xblock>
  <div class="layui-row">
    <div class="container-wrap">
      <div class="box-1">
        <table class="layui-table">
          <thead>
            <tr>
              <th>
                <div class="layui-unselect header layui-form-checkbox" lay-skin="primary"><i class="layui-icon">&#xe605;</i></div>
              </th>
              <th>工艺编号</th>
              <th>工艺类型</th>
              <th>工艺说明</th>
              <th>工序定额</th>
              <th>是否检验</th>
              <th>工序报价</th>
              <th>定额报价</th>
              <th>外协实际价格</th>
              <th>备注</th>
              <th>排序</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody>
          {volist name="processInfo" id="processInfoList"}
            <tr>
              <td>
                <div class="layui-unselect layui-form-checkbox" lay-skin="primary" data-id=''><i class="layui-icon">&#xe605;</i></div>
              </td>
              <td>{$processInfoList.process_id}</td>
              <td>{$processInfoList.process_type}</td>
              <td>{$processInfoList.process_content}</td>
              <td>{$processInfoList.process_quota}</td>
              <td>
                {if $processInfoList.if_check == 1}
                <span class="layui-badge layui-bg-blue">是</span>
                {else}
                <span class="layui-badge layui-bg-gray">否</span>
                {/if}
              </td>
              <td>{$processInfoList.process_quoted_price}</td>
              <td>{$processInfoList.quota_quotation}</td>
              <td>{$processInfoList.process_real_price}</td>
              <td>{$processInfoList.remark}</td>
              <td>
                <div class="layui-input-inline listorder" style="width: 50px;">
                  <input type="text" value="{$processInfoList.sort}" size="3" attr-id="{$processInfoList.id}" class="layui-input"  name="listorder" >
                </div>
              </td>
              <td>
                <a title="改" onclick="x_admin_show('工序明细 <span class=\'layui-badge layui-bg-blue\'>{$processInfoList.process_id}</span> 修改操作','{:url(\'index/blueprint/editProcess\',[\'id\'=>$processInfoList.id])}',450)" href="javascript:;"><i class="layui-icon">改</i></a>
                <a title="删" onclick="delete_process(this,'{$processInfoList.id}')"><i class="layui-icon">删</i></a>
              </td>
            </tr>
          {/volist}
          </tbody>
        </table>
      </div>
    </div>
    <div class="page">
      {$processInfo|raw}
    </div>
  </div>
</div>
<script>
    //排序
    $(".listorder input").blur(function () {
        var listorder =  $(this).val();
        var id = $(this).attr('attr-id');
        var url = "{:url('/index/Blueprint/updateSort')}";
        var postData ={"id":id,"listorder":listorder,'table':"product_process","value":"sort"};
        $.post(url,postData,function (result) {
            if(result == 1 ){
                layer.alert("更新成功、排序对应工序编号", {icon: 6},function () {
                    window.location.reload();  //刷新父级页面
                });
            }else {
                layer.alert("更新失败", {icon: 5});
            }
        },"json")
    });
    function sort(id) {
        var url = "{:url('/index/Blueprint/onekeySort')}";
        var postData ={"id":id};
        $.post(url,postData,function (result) {
            if(result === 1 ){
                layer.alert("排序成功", {icon: 6},function () {
                    window.location.reload();  //刷新父级页面
                });
            }else {
                layer.alert("排序失败", {icon: 5});
            }
        },"json")
    }

    /*删除*/
    function delete_process(obj,id){
        layer.confirm('确认要删除吗？',function(index){
            var url = "{:url('/index/Blueprint/deleteProcess')}";
            var postData ={"id":id};
            $.post(url,postData,function (result) {
                if(result === 1 ){
                    $(obj).parents("tr").remove();
                    layer.msg('已删除!',{icon:1,time:1000});
                }else {
                    layer.alert("排序失败", {icon: 5});
                }
            },"json");
        });
    }
</script>
</body>
</html>